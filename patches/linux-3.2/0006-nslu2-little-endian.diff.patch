From: unknown author <unknown.author@example.com>
Date: Sun, 19 Feb 2012 17:27:11 +0100
Subject: [PATCH] nslu2-little-endian.diff

---
 arch/arm/boot/compressed/Makefile        |    4 ++--
 arch/arm/boot/compressed/little-endian.S |   13 +++++++++++++
 2 files changed, 15 insertions(+), 2 deletions(-)
 create mode 100644 arch/arm/boot/compressed/little-endian.S

diff --git a/arch/arm/boot/compressed/Makefile b/arch/arm/boot/compressed/Makefile
index efb0172..8f954b7 100644
--- a/arch/arm/boot/compressed/Makefile
+++ b/arch/arm/boot/compressed/Makefile
@@ -65,9 +65,9 @@ endif
 ifeq ($(CONFIG_CPU_ENDIAN_BE32),y)
 ifeq ($(CONFIG_CPU_CP15),y)
 OBJS		+= big-endian.o
-else
-# The endian should be set by h/w design.
 endif
+else
+OBJS		+= little-endian.o
 endif
 
 ifeq ($(CONFIG_ARCH_SHMOBILE),y)
diff --git a/arch/arm/boot/compressed/little-endian.S b/arch/arm/boot/compressed/little-endian.S
new file mode 100644
index 0000000..37168f4
--- /dev/null
+++ b/arch/arm/boot/compressed/little-endian.S
@@ -0,0 +1,13 @@
+/*
+ *  linux/arch/arm/boot/compressed/little-endian.S
+ *
+ *  Switch CPU into little endian mode.
+ *  Author: Peter Korsgaard <jacmet@sunsite.dk>
+ */
+
+	.section ".start", #alloc, #execinstr
+
+	mrc	p15, 0, r0, c1, c0, 0	@ read control reg
+	bic	r0, r0, #(1 << 7)	@ enable little endian mode
+	mcr	p15, 0, r0, c1, c0, 0	@ write control reg
+
